{% extends 'base.html' %}
{% load static %}
{% block content %}

<!-- Masthead-->
<header class="masthead">
  <div class="container h-100">
    <div class="d-flex justify-content-center row h-100">
      <div class="row h-100 w-50 text-start">
        <div class="container d-flex align-items-center justify-content-center">
          <div class="container">

            <p class="text-white-75 font-weight-light mb-3" 
                  style="font-family: SDGtNeobUni-aUl;
                        font-size: 22px;
                        font-weight: normal;
                        font-stretch: normal;
                        font-style: normal;
                        line-height: 1.45;
                        letter-spacing: normal;
                        text-align: left;
                        color: #ffffff;">
                      내가 놓치고 있는 시간들은 얼마일까?</p>
            <h1 class="text-uppercase text-white-90 font-weight-normal mb-4" 
                  style="font-family: SDGtNeobUni-eSb;
                        font-size: 40px;
                        font-weight: normal;
                        font-stretch: normal;
                        font-style: normal;
                        line-height: 1.28;
                        letter-spacing: normal;
                        text-align: left;
                        color: #3e3a39;">
                        타임캐쳐,<br>더 나은<br>내일을 위한 선택</h1>

            <button type="button" class="btn btn-light" id="startbtn">
              <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-check-circle" fill="currentColor"
                xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" d="M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z" />
                <path fill-rule="evenodd"
                  d="M10.97 4.97a.75.75 0 0 1 1.071 1.05l-3.992 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.236.236 0 0 1 .02-.022z" />
              </svg>
              시작하기
            </button>

            <button type="button" class="btn btn-light" id="pausebtn">
              <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-pause-fill" fill="currentColor"
                xmlns="http://www.w3.org/2000/svg">
                <path
                  d="M5.5 3.5A1.5 1.5 0 0 1 7 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5zm5 0A1.5 1.5 0 0 1 12 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5z" />
              </svg>
              일시정지
            </button>

            <button type="button" class="btn btn-light" id="stopbtn">
              <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-check-circle-fill" fill="currentColor"
                xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd"
                  d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z" />
              </svg>
              저장하기
            </button>

          </div>
        </div>
      </div>

      <div class="row h-100 w-50 text-start justify-content-center">
        <div class="d-flex align-self-center">
          <div class="card-body text-center">

            <button type="button" class="btn btn-lg btn-light" disabled>나의 시간</button>
            <div id='box' class="box">
              <div id='timerBox' class="timerBox">
                <div id="time" class="time">00:00:00</div>
              </div>
            </div>
          </div>
          
        </div>
      </div>

    </div>
  </div>

  <!-- Core theme JS-->
  <script src="{% static 'js/scripts.js' %}"></script>

</header>

<script>

  // Set new default font family and font color to mimic Bootstrap's default styling
  Chart.defaults.global.defaultFontFamily = 'Nunito', '-apple-system,system-ui,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif';
  Chart.defaults.global.defaultFontColor = '#858796';

  $("#pausebtn").hide();
  $("#stopbtn").hide();

  window.onload = function () {
    // startbtn click css change
    document.getElementById('startbtn').onclick = function () {
      $("#startbtn").hide();
      $("#pausebtn").show();
      $("#stopbtn").show();
    }
    // pausebtn click css change
    document.getElementById('pausebtn').onclick = function () {
      $("#startbtn").show();
      $("#pausebtn").hide();
      $("#stopbtn").show();
    }

    // stopbtn 누르면 css 적용
    // 어차피 저장하면 ajax가 새로고침하니까 필요없음
    // document.getElementById('stopbtn').onclick = function() { 
    //   $("#startbtn").show();
    //   $("#pausebtn").show();
    //   $("#stopbtn").hide();
    //

  };

  // stop
  var time = 0;
  var starFlag = true;
  $(document).ready(function () {
    buttonEvt();
  });

  function init() {
    document.getElementById("time").innerHTML = "00:00:00";
  }

  function buttonEvt() {
    var hour = 0;
    var min = 0;
    var sec = 0;
    var timer;

    // start btn
    $("#startbtn").click(function () {

      if (starFlag) {
        $(".fa").css("color", "#FAED7D")
        this.style.color = "#4C4C4C";
        starFlag = false;

        if (time == 0) {
          init();
        }

        timer = setInterval(function () {
          time++;

          min = Math.floor(time / 60);
          hour = Math.floor(min / 60);
          sec = time % 60;
          min = min % 60;

          var th = hour;
          var tm = min;
          var ts = sec;
          if (th < 10) {
            th = "0" + hour;
          }
          if (tm < 10) {
            tm = "0" + min;
          }
          if (ts < 10) {
            ts = "0" + sec;
          }

          document.getElementById("time").innerHTML = th + ":" + tm + ":" + ts;
        }, 1000); // END timer
      }
    }); // END startbtn click

    // pause btn
    $("#pausebtn").click(function () {
      if (time != 0) {
        $(".fa").css("color", "#FAED7D")
        this.style.color = "#4C4C4C";
        clearInterval(timer);
        starFlag = true;
      }
    }); // END pausebtn click

    // stop btn
    $("#stopbtn").click(function () {

      if (time != 0) {
        $(".fa").css("color", "#FAED7D")
        this.style.color = "#4C4C4C";
        clearInterval(timer);
        starFlag = true;

        $.ajax({
          type: "POST",
          url: "{% url 'timesave' %}",
          data: { 'csrfmiddlewaretoken': '{{ csrf_token }}', 'time': time },
          dataType: "text",
          success: function (data) {
            console.log('성공');
            location.replace("{% url 'index' %}");
          },
          error: function (request, status, error) {
            console.log('실패');
            console.log(request);
            console.log(error);
          }
        }); // END AJAX
        time = 0;
        init();
      } // END IF

    }); // END stopbtn click

  }

</script>
{% endblock %}